/**
 * <%= model.label%> REST controller.
 *
 * Auto-generated by modelGenerator.
 *
 * @author  Nicolas Iglesias <nico@webpolis.com.ar> for daturajs - https://github.com/webpolis/daturajs -
 * @class   <%= model.camelName%>Controller
 * @date    <%= Date()%>
 */

// @todo REST must have token authorization and some sort of mechanism to authenticate client
module.exports = function(){
    var <%= model.camelName%>Controller = {
        list : function (){
            var _this = this;
            var <%= model.camelName%> = this.models.<%= model.name%>;

            <%= model.camelName%>.find('all',{
                conditions: [], // 'id = :id'
                params: {}, // id: 20
                fields: <%= model.camelName%>.getListableColumns(),
                order: undefined
            },function(<%= model.pluralName%>){
                _this.send(200,{
                    <%= model.pluralName%>: <%= model.pluralName%>
                })
            })
        },
        save : function(){
            var _this = this;
            var <%= model.camelName%> = this.data.<%= model.camelName%>;
            
            var ret = function(err){
                _this.send(err?400:200,{
                    <%= model.camelName%>: <%= model.camelName%>
                })
            }
            
            if(<%= model.camelName%>.id && <%= model.camelName%>.id !== null){
                // update
                var _<%= model.camelName%> = this.models.<%= model.name%>.getInstance(<%= model.camelName%>);
                delete <%= model.camelName%>.id
                
                _<%= model.camelName%>.$update(<%= model.camelName%>, null, function(_model){
                    <%= model.camelName%> = _model;
                    ret(false)
                })
            }else{
                // create new
                this.models.<%= model.name%>.create(<%= model.camelName%>, function(_<%= model.camelName%>){
                    <%= model.camelName%> = _<%= model.camelName%>;
                    ret(false)
                }, function(){
                    ret(true)
                })
            }
        },
        remove : function(){
            var _this = this;
            var <%= model.camelName%> = this.models.<%= model.name%>.getInstance(this.data.<%= model.camelName%>);
            
            <%= model.camelName%>.$delete(function(){
                _this.send(200,true);
            });
        }
    };
    
    return <%= model.camelName%>Controller;
}