<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lib&#x2F;models&#x2F;index.js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/core.html">core</a></li>
            
                <li><a href="..&#x2F;classes/db.html">db</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/core.html">core</a></li>
            
                <li><a href="..&#x2F;modules/db.html">db</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: lib&#x2F;models&#x2F;index.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * Models initialization file.
 * 
 * You will not likely need to modify this file.
 * 
 * @author Nicolas Iglesias &lt;nicolas@clevertech.biz&gt;
 *&#x2F;
var fs = require(&#x27;fs&#x27;)
,path = require(&#x27;path&#x27;)
,config = require(path.resolve(__dirname+&#x27;&#x2F;..&#x2F;..&#x2F;src&#x2F;config&#x2F;main&#x27;)).main.db
,lib = require(path.resolve(__dirname+&#x27;&#x2F;..&#x2F;&#x27;))
,db = require(path.resolve(__dirname+&#x27;&#x2F;..&#x2F;adapters&#x2F;db&#x27;));

&#x2F;&#x2F; initialize sequelize.
var dbAdapter = db().initialize();

&#x2F;&#x2F; dynamically build models array for internal usage.
fs.readdir(path.resolve(__dirname+&#x27;&#x2F;..&#x2F;..&#x2F;src&#x2F;models&#x27;),function(err,l){
    l.forEach(function(j){
        j = path.basename(j,&#x27;.js&#x27;);
        if(!&#x2F;index&#x2F;i.test(j)){
            try{
                &#x2F;&#x2F; get instance per orm
                var ormModel = db().loadORMModel(j);
                lib.core.ormModels[ormModel.name]=ormModel;
            }catch(e){
                console.trace(e)
            }
        } 
    });
    
    &#x2F;&#x2F; setup relationships (must be done here so we can access all models instances).
    if(typeof lib.core.ormModels !== &#x27;undefined&#x27;){
        for(var modelName in lib.core.ormModels){
            var ormModel = lib.core.ormModels[modelName];
            
            for(var relType in lib.core.ormModels[modelName]._customRelationships){
                var rel = lib.core.ormModels[modelName]._customRelationships;
                if(rel[relType].length &gt;0){
                    rel[relType].forEach(function(r){
                        
                        switch(config.adapter){
                            case &#x27;sequelize&#x27;:
                                &#x2F;&#x2F; config relation
                                var relConfig = {
                                    as: rel.alias ? r.alias : r.model,
                                    foreignKey : r.foreignKey ? r.foreignKey : r.model+&#x27;_id&#x27;
                                };
                        
                                &#x2F;&#x2F; self-to-self relation
                                if(r.selfRelationship)
                                    relConfig.useJunctionTable = false
                        
                                &#x2F;&#x2F; many-to-many relation
                                if(r.joinTable)
                                    relConfig.joinTableName = r.joinTable
                        
                                &#x2F;&#x2F; set relation
                                ormModel[relType](lib.core.ormModels[r.model], relConfig);
                                break;
                        }
                    });
                }
            }
            
            &#x2F;&#x2F; build new instance of local model
            var model = db().getLocalModelFromORM(ormModel);
            lib.core.models[ormModel.name] = model;
        }
    }
});

module.exports = lib.core.models;
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
