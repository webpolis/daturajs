var orm = require("../lib/ORM");

// orm.connect("postgres://dresende@localhost:/orm_test", function (err, db) {
orm.connect("mysql://root:tedua@localhost/orm", function (err, db) {
// orm.connect("mongodb:///test", function (err, db) {
// orm.connect("sqlite://", function (err, db) {
	if (err) {
		console.log("ERROR");
		throw err;
	}

	db.load(__dirname + "/test-model-person", function (err) {
		if (err) {
			console.log("LOAD ERROR", err);
			throw err;
		}

		var Person = db.models.person;
		var Pet    = db.models.pet;

		Person.get(1, function (err, John) {
			console.log("err?", err);

			console.log(John.id, John);

			John.getAvatar(function (err, photo) {
				console.log("err?", err);
				console.log("photo", photo.length);

				John.removeAvatar(function (err) {
					console.log("err?", err);
					console.log("wait 10sec..");

					setTimeout(function () {

						John.setAvatar(photo, function (err) {
							console.log("err?", err);
						});

					}, 10e3);
				});
			});
		});
	});
});
